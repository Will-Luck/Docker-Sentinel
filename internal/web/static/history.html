{{define "history.html"}}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Update History — Docker-Sentinel</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="layout" id="layout">
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <span class="sidebar-logo">S</span>
                <span class="sidebar-label sidebar-brand">Sentinel</span>
                <button class="sidebar-toggle" onclick="toggleSidebar()" title="Toggle sidebar">&#171;</button>
            </div>
            <nav class="sidebar-nav">
                <a href="/" class="sidebar-link" data-page="dashboard">
                    <span class="sidebar-icon">&#9636;</span>
                    <span class="sidebar-label">Dashboard</span>
                </a>
                <a href="/queue" class="sidebar-link" data-page="queue">
                    <span class="sidebar-icon">&#9776;</span>
                    <span class="sidebar-label">Queue</span>
                    {{if .QueueCount}}<span class="sidebar-badge">{{.QueueCount}}</span>{{end}}
                </a>
                <a href="/history" class="sidebar-link active" data-page="history">
                    <span class="sidebar-icon">&#8635;</span>
                    <span class="sidebar-label">History</span>
                </a>
            </nav>
            <div class="sidebar-footer">
                <button class="sidebar-link" onclick="cycleTheme()" id="theme-toggle" type="button">
                    <span class="sidebar-icon" id="theme-icon">&#9790;</span>
                    <span class="sidebar-label" id="theme-label">Dark</span>
                </button>
                <div class="sidebar-status">
                    <span id="sse-indicator" class="status-dot disconnected" title="Disconnected"></span>
                    <span class="sidebar-label" id="sse-label">Disconnected</span>
                </div>
            </div>
        </aside>

        <main class="main-content">
            <div class="page-header">
                <div>
                    <h1>Update History</h1>
                    <p class="subtitle">Chronological record of container updates and rollbacks</p>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2>Recent Updates ({{len .History}})</h2>
                </div>
                <div class="table-wrap">
                    <table>
                        <thead>
                            <tr>
                                <th>Time</th>
                                <th>Container</th>
                                <th>Outcome</th>
                                <th>Duration</th>
                            </tr>
                        </thead>
                        <tbody>
                            {{if .History}}
                                {{range $i, $r := .History}}
                                <tr class="container-row" onclick="onRowClick(event, 'history-{{$i}}')">
                                    <td title="{{fmtTime $r.Timestamp}}">{{fmtTimeAgo $r.Timestamp}}</td>
                                    <td><a href="/container/{{$r.ContainerName}}" class="container-link">{{$r.ContainerName}}</a></td>
                                    <td>
                                        {{if eq $r.Outcome "success"}}
                                            <span class="badge badge-success">Success</span>
                                        {{else if eq $r.Outcome "rollback"}}
                                            <span class="badge badge-error">Rollback</span>
                                        {{else}}
                                            <span class="badge badge-muted">{{$r.Outcome}}</span>
                                        {{end}}
                                    </td>
                                    <td class="mono">{{fmtDuration $r.Duration}}</td>
                                </tr>
                                <tr class="accordion-panel" id="accordion-history-{{$i}}" style="display:none">
                                    <td colspan="4">
                                        <div class="accordion-content">
                                            <div class="accordion-grid">
                                                <div class="accordion-section">
                                                    <div class="accordion-label">Timestamp</div>
                                                    <div class="accordion-value mono">{{fmtTime $r.Timestamp}}</div>
                                                    <div class="accordion-label">Old Image</div>
                                                    <div class="accordion-value mono">{{$r.OldImage}}</div>
                                                    <div class="accordion-label">New Image</div>
                                                    <div class="accordion-value mono">{{$r.NewImage}}</div>
                                                </div>
                                                <div class="accordion-section">
                                                    <div class="accordion-label">Old Digest</div>
                                                    <div class="accordion-value mono">{{if $r.OldDigest}}{{$r.OldDigest}}{{else}}<span class="text-muted">—</span>{{end}}</div>
                                                    <div class="accordion-label">New Digest</div>
                                                    <div class="accordion-value mono">{{if $r.NewDigest}}{{$r.NewDigest}}{{else}}<span class="text-muted">—</span>{{end}}</div>
                                                    {{if $r.Error}}
                                                    <div class="accordion-label">Error</div>
                                                    <div class="accordion-value mono" style="color: var(--error);">{{$r.Error}}</div>
                                                    {{end}}
                                                </div>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                {{end}}
                            {{else}}
                                <tr>
                                    <td colspan="4">
                                        <div class="empty-state">
                                            <h3>No history yet</h3>
                                            <p>Update records will appear here after Sentinel performs its first container update.</p>
                                        </div>
                                    </td>
                                </tr>
                            {{end}}
                        </tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>

    <div id="toast-container" class="toast-container"></div>
    <script src="/static/app.js"></script>
</body>
</html>
{{end}}
